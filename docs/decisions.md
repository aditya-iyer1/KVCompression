# Decisions & Terminology Lock

Single source of locked terminology and interpretation rules for the KV Transition harness and reports. For architecture and phase breakdown, see [Pointers](#pointers) below.

---

## Terminology Lock (v1)

- **Accuracy**  
  Mean F1 per context-length bin (and overall when aggregated). EM is also computed where applicable. Reported as *Acc Mean* in bin stats and plots. Higher is better; a drop as KV budget decreases can indicate compression-induced degradation.

- **Failure rate**  
  Fraction of requests in a bin (or overall) that did not yield a scorable response: timeouts, rate limits, empty or malformed output, refusals, etc. Stored per request in the `failures` table with an `error_type`. High failure rate can masquerade as accuracy collapse if not separated from true accuracy.

- **Transition zone / transition bin**  
  The context-length region (or single bin) where the accuracy drop *between two KV budgets* crosses the configured detection threshold. The harness detects a transition when a sufficient drop occurs at a given bin when moving from a higher budget to a lower one.  
  **“No transition detected”** means no such drop met the threshold. Common reasons: flat accuracy, insufficient bin resolution, too few examples per bin, or failures dominating so the accuracy signal is weak.

- **Collapse vs degradation**  
  - **Degradation (accuracy-driven):** The model still produces answers; quality drops (lower F1/EM). This is the typical “compression hurts quality” signal.  
  - **Collapse (failure-driven):** Many requests do not yield a scorable response; reported accuracy is over a shrinking subset. If failure rate spikes before or with an accuracy drop, treat as system failure (e.g. rate limits, timeouts) rather than pure quality degradation.

- **Bin**  
  A token-length bucket: examples are assigned to bins by prompt token length (e.g. via quantiles). **Bin index** ordering is short → long: bin 0 = shortest context lengths, higher indices = longer. Tables and plots use `bin_idx` consistently.

- **Budget**  
  KV cache retention/compression budget (e.g. 1.0 = baseline, 0.5 / 0.2 = degraded). Configured per run via `kv.budgets`. Lower budget trades memory/latency for potential accuracy and stability loss.

- **Run group (`exp_group_id`), `run_id`, and non-mixing invariant**  
  - **Run group:** One experiment group identified by `exp_group_id` (from config `output.exp_group_id`). All runs in the group share the same DB and report directory: `runs/<exp_group_id>/`.  
  - **Run:** A single inference pass over the manifest for one KV budget, identified by `run_id` (e.g. `<exp_group_id>_budget_1.0`).  
  - **Non-mixing invariant:** The harness does not mix new requests with existing persisted requests for the same `run_id`. Re-running inference for the same config therefore requires either a **new `exp_group_id`** or running **`clean -c <config> --yes`** to remove the run group’s artifacts, then re-running. Otherwise the CLI errors (e.g. “already has N request(s) persisted”).

---

## Interpretation Rules

- **“Accuracy improved under degradation”**  
  When a lower KV budget shows *higher* reported accuracy than a higher budget, treat as likely **noise** (small samples, variance). Sanity-check: inspect failure rate and per-bin N; if failures dominate or N is very small, the comparison is not reliable.

- **When to treat results as infrastructure artifacts**  
  - **RATE_LIMITED** spikes: API rate limits (e.g. HTTP 429). Rerun with lower request rate or adjust pacing; do not interpret as model/compression degradation.  
  - **Timeouts / ENGINE_ERROR:** Server or connection failures. Retry or fix infrastructure; exclude affected runs from interpretation if persistent.

See also [README § How to Read Failures](../README.md#how-to-read-failures) and the report’s “Collapse vs degradation” and “Limitations” sections.

---

## Pointers

| Resource | Description |
|----------|-------------|
| **Architecture / blueprint** | [docs/blueprint_v1.md](blueprint_v1.md) (or [docs/blueprint_v2.md](blueprint_v2.md) when populated) for phases, modules, and design. |
| **Run history / completion log** | [docs/log.md](log.md) for phase completion and implementation history. |
| **Primary report artifact** | `runs/<exp_group_id>/report.md` — generated by `report` (or `all`); contains transition summary, plots, bin stats, and interpretation narrative. |
